version: '2'
services:
  vrouter-tor-agent_id_{{item.1}}:
    image: "{{ container_registry }}/contrail-vrouter-tor-agent:{{ contrail_version_tag }}"
    network_mode: host
    privileged: true
    pid: host
    env_file: "{{ item.0 }}"
    volumes:
      - /usr/src:/usr/src
      - /lib/modules:/lib/modules
      - /bin:/host/bin
      - /var/lib/contrail:/var/lib/contrail
      - /var/run:/var/run
{% if ansible_os_family == 'RedHat' %}
      - /etc/sysconfig/network-scripts:/etc/sysconfig/network-scripts
{% endif %}
      - /dev/log:/dev/log
    volumes_from:
      - node-init
    depends_on:
      - vrouter-agent
      - node-init
    logging:
      driver: "{{ compute_log_driver }}"
      options:
        max-size: "{{ compute_log_max_size }}"
        max-file: "{{ compute_log_max_file }}"
    restart: always
    stdin_open: {{ contrail_configuration.STDIN_OPEN }}
    tty: {{ contrail_configuration.TTY }}
