---
- name: create common-env configmap
  shell: kubectl create configmap common-env --from-env-file=/etc/contrail/common.env -n kube-system
  when: 
    - roles[instance_name].k8s_master is defined and master_inventory is defined and inventory_hostname == master_inventory

- name: create contrail config database with k8s
  include: create_config_database.yml
  when: 
    - inventory_hostname == master_inventory

- name: create contrail config with k8s
  include: create_config.yml
  when: 
    - inventory_hostname == master_inventory

- name: create contrail webui with k8s
  include: create_webui.yml
  when: 
    - inventory_hostname == master_inventory

- name: create contrail control  with k8s
  include: create_control.yml
  when: 
    - inventory_hostname == master_inventory

# TODO: make contrail only work with k8s
#- name: create contrail control_only with k8s
#  include: create_control_only.yml
#  when: 
#    - inventory_hostname == master_inventory

- name: create contrail analytics database with k8s
  include: create_analytics_database.yml
  when:
    - inventory_hostname == master_inventory

- name: create contrail analytics with k8s
  include: create_analytics.yml
  when:
    - inventory_hostname == master_inventory

- name: create contrail kube manager
  include: create_kubemanager.yml
  when:
    - inventory_hostname == master_inventory

# TODO: The following, till end of file,  has to be removed once we re-add node init support to the k8s PODs

- name: create contrail-status command
  template:
    src: contrail-status-REMOVE-ME.yaml.j2
    dest: /usr/bin/contrail-status

- name: change contrail-status permissions
  file:
    path: /usr/bin/contrail-status
    mode: 0755
