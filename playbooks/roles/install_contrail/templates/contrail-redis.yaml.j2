version: '2'
services:
  redis:
    image: "redis:4.0.2"
    env_file: /etc/contrail/common.env
    network_mode: "host"
    restart: always
    command: [
      "bash", "-c",
      '
       if [ -z "$$REDIS_SERVER_PASSWORD" ];then
           docker-entrypoint.sh
           --bind "$$IPFABRIC_SERVICE_HOST" 127.0.0.1
           --protected-mode yes
           --lua-time-limit 15000
           --dbfilename "";
       else
           docker-entrypoint.sh
           --bind "$$IPFABRIC_SERVICE_HOST" 127.0.0.1
           --protected-mode yes
           --lua-time-limit 15000
           --requirepass "$$REDIS_SERVER_PASSWORD"
           --dbfilename "";
       fi
      '
    ]
