---
- name: OS specific package install
  include: RedHat.yml
  when: ansible_os_family == 'RedHat'

- name: install git to operate on kolla branches
  package:
    name: git
    state: present
  become: yes

- name: check if pip present
  shell: pip --version
  ignore_errors: true
  register: pip_check

- name: Install pip
  block:
    - name: Download pip
      get_url:
        url: "{{ get_pip_url }}"
        dest: /tmp/get-pip.py
        mode: 0400
    - name: Install pip
      shell: "python /tmp/get-pip.py"
      become: yes
  when:
    - pip_check.rc != 0

- name: upgrade pip
  pip:
    name: pip
    extra_args: --upgrade
  become: yes

- name: install right versions of kollas' deps
  pip:
    name: "{{ item }}"
    extra_args: --upgrade
  with_items:
    - jinja2
    - setuptools
    - jmespath
  become: yes

- name: install packages used to generate passwords
  pip:
    name: "{{ item }}"
    state: latest
  with_items:
    - pycrypto
    - oslo.config
    - oslo.utils
  become: yes
