---
- name: set contrail configuration to empty if absent
  set_fact:
   contrail_configuration: {}
  when: contrail_configuration is undefined
  tags:
   - always

- name: install software
  include: install_software.yml

- name: Setup interfaces for all instances
  include: interface_setup.yml
  when: instance_data.additional_interfaces

- name: Setup Static Routes
  include: staticroute_setup.yml
  when: instance_data.routes is defined

- name: copy root ca
  include: copy_root_ca.yml
  when:
    - (( contrail_configuration.SSL_ENABLE is defined ) and
      ( contrail_configuration.SSL_ENABLE|bool )) or
      (( contrail_configuration.XMPP_SSL_ENABLE is defined ) and
      ( contrail_configuration.XMPP_SSL_ENABLE|bool )) or
      (( contrail_configuration.INTROSPECT_SSL_ENABLE is defined ) and
      ( contrail_configuration.INTROSPECT_SSL_ENABLE|bool )) or
      (( contrail_configuration.SANDESH_SSL_ENABLE is defined ) and
      ( contrail_configuration.SANDESH_SSL_ENABLE|bool ))
