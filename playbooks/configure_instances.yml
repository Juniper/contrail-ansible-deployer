# ansible-playbook -i inventory/ -e orchestrator=openstack playbook/install_openstack.yml
#
- name: Create container host group
  hosts: localhost
  connection: local
  gather_facts: yes
  pre_tasks:
    - name: Expose instances
      set_fact:
          instances: "{{ instances }}"
      when: hostvars['localhost']['instances'] is undefined
  roles:
    - create_container_host_group
    - name: Clone kolla-ansible
      role: create_kolla_playbooks 
      when:
        - orchestrator is defined
        - orchestrator == 'openstack'
    - name: prepare localhost for kolla
      role: install_kolla_dependencies
      when:
        - orchestrator is defined
        - orchestrator == 'openstack'
    - generate_root_ca
  vars_files:
    - "{{ config_file }}"

- name: Configure instance(s)
  hosts: container_hosts
  gather_facts: yes
  roles:
    - configure_instances
  vars_files:
    - "{{ hostvars['localhost'].config_file }}"
  environment:
    - https_proxy: "{{ contrail_configuration.HTTPS_PROXY | default('') }}"
    - http_proxy: "{{ contrail_configuration.HTTP_PROXY | default('') }}"
